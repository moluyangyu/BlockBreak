using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.SceneManagement;

public class UIControl : MonoBehaviour
{
    // Start is called before the first frame update
    //获胜界面
    private GameObject win;
    //失败界面
    private GameObject lose;
    //关卡解锁
    private GameObject levelLock;
    //[Header("当前关卡数")]
    //public int checkNumber;
    public GameObject dex;//图鉴游戏体
    public GameObject dexButton;//打开图鉴的按钮
    public GameObject nextLevel;//下一关按钮的游戏体
    //public GameObject DialogueMask;//对话遮罩
    void Start()
    {
        //  win = GameObject.Find("Win");
        //   win?.SetActive(false);
        //  lose = GameObject.Find("Lose");
        //   lose?.SetActive(false);
        //levelLock = GameObject.Find("LevelLock");
        dex = GameObject.Find("GameDex");
        dexButton = GameObject.Find("OpenGameDex");
        nextLevel = GameObject.Find("NextLevel");
       // DialogueMask = GameObject.Find("对话蒙版");
        if (dex!=null)
        {
            dex.SetActive(false);
            dexButton.SetActive(false);
            nextLevel.SetActive(false);
        }
       // Debug.Log("关闭完成");


    }
    private void OnEnable()
    {
        // 注册事件
        SceneManager.sceneLoaded += OnSceneLoaded;
        UiStatic.GameDexTrigger += OpenDex;
        UiStatic.NextLevel += OpenNextButton;
    }

    private void OnDisable()
    {
        // 移除事件，以避免重复注册
        SceneManager.sceneLoaded -= OnSceneLoaded;
        UiStatic.GameDexTrigger -= OpenDex;
        UiStatic.NextLevel -= OpenNextButton;
    }

    // 场景加载完成时调用的方法
    private void OnSceneLoaded(Scene scene, LoadSceneMode mode)
    {

    }
    /// <summary>
    /// 开关胜负界面
    /// </summary>
    /// <param name="a"></param>传达输或者赢的变量
    public void End(bool a)
    {
        if (a)
        {
            win.SetActive(true);
          //  levelLock.GetComponent<LevelLock>().AddNumber(checkNumber);//通关了就解锁新的关卡
        }
        else
        {
            lose.SetActive(true);
        }
    }
    /// <summary>
    /// 给UI用的跳转场景的
    /// </summary>
    /// <param name="i"></param>场景编号
    public void LoadScence(int i)
    {
        if (levelLock != null)
        {
           /* if (i <= levelLock.GetComponent<LevelLock>().levelNumber)
            {
                SceneManager.LoadScene(i);
            }*/
        }
        else
        {
            SceneManager.LoadScene(i);
        }
    }
    /// <summary>
    /// 主界面开始按钮调用的函数
    /// </summary>
    public void StartButton()
    {
        SceneManager.LoadScene(2);
        GameObject.Find("start").GetComponent<Animator>().SetTrigger("点击");
    }
    /// <summary>
    /// 退出游戏
    /// </summary>
    public void QuitGame()
    {
        Application.Quit();
    }
    /// <summary>
    /// 打开图鉴
    /// </summary>
    public void OpenDex(int i)
    {
        dex.SetActive(true);
        dexButton.SetActive(true);
        UiStatic.GameDexTrigger -= OpenDex;
        //UiStatic.UiOpenIssue(true);
        UiStatic.GameDexTriggerIssue(i);//在图鉴游戏体打开以后再传一次消息才能接收到
        UiStatic.GameDexTrigger += OpenDex;
        
    }
    public void OpenDex()//UI界面按钮用的重载
    {
        dex.SetActive(true);
        dex.GetComponent<GameDexControl>().UpdateDex(dex.GetComponent<GameDexControl>().pageNumber);//打开上一次打开的页码
        dexButton.SetActive(false);
        UiStatic.UiOpenIssue(false);
      //  dex.GetComponent<MonoBehaviour>().enabled = true;
    }
    /// <summary>
    /// 关闭图鉴
    /// </summary>
    public void CloseDex()
    {
        dex.SetActive(false);
        dexButton.SetActive(true);
        UiStatic.UiOpenIssue(true);
        //dex.GetComponent<MonoBehaviour>().enabled = true;
    }
    /// <summary>
    /// 图鉴加载下一页的内容
    /// </summary>
    public void DexNextPage()
    {
        dex.GetComponent<GameDexControl>().NextPage();
    }
    /// <summary>
    /// 图鉴加载上一页的内容
    /// </summary>
    public void DexLastPage()
    {
        dex.GetComponent<GameDexControl>().LastPage();
    }
    /// <summary>
    /// 打开通关的按钮
    /// </summary>
    public void OpenNextButton()
    {
        nextLevel.SetActive(true);
    }
}
